env:
  # Optional value, can manually trigger input for patch/minor/major to control version bump
  VERSION_BUMP: ${{ github.event.inputs.version_bump || 'patch' }} 

on:
  push:
    branches:
      - main
      - 'feature-*'
      - 'feat-*'
    tags:
      - 'v*'
  
  workflow_dispatch:
    inputs:
      version_bump:
        description: "Version bump level"
        required: false
        default: "patch"
        type: choice
        options:
          - patch
          - minor
          - major

jobs:
  build-and-publish:
    runs-on: ubuntu-latest

    steps:
      # Check out the code repository
      - uses: actions/checkout@v3

      # Set up Node.js environment
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          registry-url: 'https://registry.npmjs.org/'

      # Cache Yarn dependencies
      - name: Cache Yarn
        uses: actions/cache@v3
        with:
          path: |
            .yarn/cache
            .yarn/install-state.gz
          key: yarn-${{ runner.os }}-${{ hashFiles('yarn.lock') }}

      # Check Node.js version
      # - name: Check Node version
      #   run: node --version

      # Check Yarn version
      # - name: Check Yarn version
      #   run: yarn --version

      # Install project dependencies
      # - name: Install dependencies
      #   run: yarn install 

      # Build the project
      # - name: Build project
      #   run: yarn build


      # Publish the RPC package to npm
      - name: Publish RPC Package
        run: |
          bash ./scripts/publish-rpc.sh
        env:
          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
